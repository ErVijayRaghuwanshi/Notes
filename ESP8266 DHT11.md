# ESP8266 DHT11 Temperature and Humidity Monitoring

## Overview
The ESP8266 is a low-cost WiFi microcontroller that can be used for IoT applications. The DHT11 is a basic temperature and humidity sensor. This guide covers setting up DHT11 with ESP8266.

## Hardware Requirements
- ESP8266 Development Board
- DHT11 Sensor
- 10kΩ Resistor (pull-up for data line)
- Jumper wires
- USB Cable for programming

## Wiring Diagram
```
DHT11 Pin 1 (VCC) → ESP8266 3.3V
DHT11 Pin 2 (Data) → ESP8266 D4 (GPIO2) with 10kΩ pull-up
DHT11 Pin 3 (NC) → Not connected
DHT11 Pin 4 (GND) → ESP8266 GND
```

## Arduino IDE Setup
1. Install Arduino IDE
2. Add ESP8266 board support via Board Manager
3. Install DHT library: `DHT sensor library` by Adafruit
4. Select board: "NodeMCU 1.0 (ESP-12E Module)"

## Basic Code Example
```cpp
#include <DHT.h>

#define DHTPIN D4
#define DHTTYPE DHT11

DHT dht(DHTPIN, DHTTYPE);

void setup() {
  Serial.begin(115200);
  dht.begin();
}

void loop() {
  float humidity = dht.readHumidity();
  float temperature = dht.readTemperature();
  
  if (isnan(humidity) || isnan(temperature)) {
    Serial.println("Failed to read from DHT sensor!");
    return;
  }
  
  Serial.print("Humidity: ");
  Serial.print(humidity);
  Serial.print(" %\t");
  Serial.print("Temperature: ");
  Serial.print(temperature);
  Serial.println(" °C");
  
  delay(2000);
}
```

## WiFi Integration
```cpp
#include <ESP8266WiFi.h>
#include <DHT.h>

const char* ssid = "YOUR_SSID";
const char* password = "YOUR_PASSWORD";

#define DHTPIN D4
#define DHTTYPE DHT11

DHT dht(DHTPIN, DHTTYPE);

void setup() {
  Serial.begin(115200);
  dht.begin();
  WiFi.begin(ssid, password);
  
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("\nWiFi connected!");
}

void loop() {
  float humidity = dht.readHumidity();
  float temperature = dht.readTemperature();
  
  if (!isnan(humidity) && !isnan(temperature)) {
    // Send data to server here
    Serial.print("Temperature: ");
    Serial.print(temperature);
    Serial.print(" °C, Humidity: ");
    Serial.print(humidity);
    Serial.println(" %");
  }
  
  delay(5000);
}
```

## MQTT Integration
```cpp
#include <ESP8266WiFi.h>
#include <PubSubClient.h>
#include <DHT.h>

const char* ssid = "YOUR_SSID";
const char* password = "YOUR_PASSWORD";
const char* mqtt_server = "YOUR_MQTT_BROKER";

#define DHTPIN D4
#define DHTTYPE DHT11

DHT dht(DHTPIN, DHTTYPE);
WiFiClient espClient;
PubSubClient client(espClient);

void setup() {
  Serial.begin(115200);
  dht.begin();
  WiFi.begin(ssid, password);
  client.setServer(mqtt_server, 1883);
}

void reconnect() {
  while (!client.connected()) {
    if (client.connect("ESP8266_DHT11")) {
      Serial.println("MQTT connected");
    }
  }
}

void loop() {
  if (!client.connected()) {
    reconnect();
  }
  client.loop();
  
  float humidity = dht.readHumidity();
  float temperature = dht.readTemperature();
  
  if (!isnan(humidity) && !isnan(temperature)) {
    client.publish("sensor/temperature", String(temperature).c_str());
    client.publish("sensor/humidity", String(humidity).c_str());
  }
  
  delay(5000);
}
```

## Python Simulation for Grafana

### Overview
This Python simulation allows you to test Grafana dashboards without hardware. It generates realistic sensor data and publishes it via MQTT.

### Prerequisites
```bash
pip install paho-mqtt
```

### Simulation Script
```python
import paho.mqtt.client as mqtt
import time
import random
import math

# MQTT Configuration
MQTT_BROKER = "localhost"  # Change to your MQTT broker IP
MQTT_PORT = 1883
MQTT_TOPIC_TEMP = "sensor/temperature"
MQTT_TOPIC_HUMIDITY = "sensor/humidity"

# Simulation Parameters
BASE_TEMPERATURE = 25.0
BASE_HUMIDITY = 50.0
TEMP_VARIATION = 5.0
HUMIDITY_VARIATION = 15.0
UPDATE_INTERVAL = 5  # seconds

class SensorSimulator:
    def __init__(self):
        self.client = mqtt.Client()
        self.client.on_connect = self.on_connect
        self.client.on_disconnect = self.on_disconnect
        self.time_offset = 0
    
    def on_connect(self, client, userdata, flags, rc):
        if rc == 0:
            print("Connected to MQTT Broker!")
        else:
            print(f"Connection failed with code {rc}")
    
    def on_disconnect(self, client, userdata, rc):
        print("Disconnected from MQTT Broker")
    
    def generate_temperature(self):
        """Generate realistic temperature data with daily variation"""
        sine_variation = TEMP_VARIATION * math.sin(self.time_offset / 3600.0)
        noise = random.uniform(-1, 1)
        return BASE_TEMPERATURE + sine_variation + noise
    
    def generate_humidity(self):
        """Generate realistic humidity data"""
        sine_variation = HUMIDITY_VARIATION * math.cos(self.time_offset / 3600.0)
        noise = random.uniform(-2, 2)
        return max(0, min(100, BASE_HUMIDITY + sine_variation + noise))
    
    def run(self):
        """Start the simulation"""
        try:
            self.client.connect(MQTT_BROKER, MQTT_PORT, 60)
            self.client.loop_start()
            
            print("Starting sensor simulation...")
            print(f"Publishing to {MQTT_BROKER}:{MQTT_PORT}")
            
            while True:
                temperature = self.generate_temperature()
                humidity = self.generate_humidity()
                
                # Publish data
                self.client.publish(MQTT_TOPIC_TEMP, f"{temperature:.2f}")
                self.client.publish(MQTT_TOPIC_HUMIDITY, f"{humidity:.2f}")
                
                print(f"Published - Temp: {temperature:.2f}°C, Humidity: {humidity:.2f}%")
                
                self.time_offset += UPDATE_INTERVAL
                time.sleep(UPDATE_INTERVAL)
        
        except KeyboardInterrupt:
            print("\nSimulation stopped")
        finally:
            self.client.loop_stop()
            self.client.disconnect()

if __name__ == "__main__":
    simulator = SensorSimulator()
    simulator.run()
```

### Running the Simulation
1. Ensure MQTT broker is running (e.g., Mosquitto)
2. Update `MQTT_BROKER` if not localhost
3. Run the script:
```bash
python sensor_simulator.py
```

### Grafana Integration
1. Add MQTT data source in Grafana
2. Create queries for `sensor/temperature` and `sensor/humidity`
3. Build dashboards to visualize the simulated data

## Troubleshooting

### Issue: Failed to read from DHT sensor
**Solution:** 
- Check wiring connections
- Verify 10kΩ pull-up resistor is properly connected
- Ensure DHT library is installed correctly

### Issue: No WiFi connection
**Solution:**
- Verify SSID and password are correct
- Check if ESP8266 is in range
- Try resetting the ESP8266

### Issue: MQTT connection fails
**Solution:**
- Confirm MQTT broker is running
- Check firewall settings
- Verify broker address and port

### Issue: Inaccurate readings
**Solution:**
- Ensure sensor is not in direct sunlight
- Place sensor in free air, not enclosed space
- Allow 2-3 seconds between readings

## Resources
- [ESP8266 Documentation](https://arduino-esp8266.readthedocs.io/)
- [DHT Sensor Library](https://github.com/adafruit/DHT-sensor-library)
- [MQTT Protocol](https://mqtt.org/)
- [Grafana Documentation](https://grafana.com/docs/)
